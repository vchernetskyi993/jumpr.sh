#!/usr/bin/env python

import os
import sys
from pathlib import Path


def main():
    out_dir = _out_dir()
    script_name = Path(sys.argv[0]).name
    args = " ".join(sys.argv[1:])
    args_file = out_dir / f"{script_name}_args"

    with args_file.open("a") as fh:
        _ = fh.write(f"{script_name} {args}\n")

    mocks_dir = _mocks_dir()
    # parse {mocks_dir}/{script_name}.yml|yaml if exists
    # for each key in args: print value


def _out_dir() -> Path:
    stub_args = os.environ.get("OUT_DIR")
    if not stub_args:
        print("OUT_DIR must be set to a writable directory", file=sys.stderr)
        sys.exit(1)

    return Path(stub_args)


def _mocks_dir() -> Path | None:
    stub_args = os.environ.get("MOCKS_DIR")
    return Path(stub_args) if stub_args else None


if __name__ == "__main__":
    main()
